name: ğŸ§ª Release QA Summary & Pre-Deployment Check

on:
  workflow_run:
    workflows:
      - "ğŸ§± Backend QA Full Suite"
      - "ğŸ¨ Frontend QA & Build Validation"
    types:
      - completed

  workflow_dispatch:

jobs:
  release-summary:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout repo
        uses: actions/checkout@v4

      - name: â¬‡ï¸ Download QA Reports
        uses: actions/download-artifact@v4
        with:
          name: "qa-reports"
        continue-on-error: true

      - name: ğŸ§© Combine Backend & Frontend Reports
        run: |
          mkdir -p logs

          BACKEND=$(jq -r '.status // "missing"' qa-reports/backend-qa-report/backend-report.json 2>/dev/null || echo "missing")
          FRONTEND=$(jq -r '.status // "missing"' qa-reports/frontend-qa-report/frontend-report.json 2>/dev/null || echo "missing")

          echo "{\"timestamp\":\"$(date -u +'%Y-%m-%dT%H:%M:%SZ')\", \"backend\":\"$BACKEND\", \"frontend\":\"$FRONTEND\"}" \
            > logs/release-summary.json

      - name: ğŸ“¤ Upload Summary Artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-summary
          path: logs/release-summary.json

      # -------------------------------------------------------------
      # ğŸ”• DISCORD NOTIFICATION DESACTIVÃ‰E POUR Ã‰VITER LE FAIL
      # -------------------------------------------------------------
      - name: ğŸ”• Skip Discord Notification
        run: echo "Discord summary disabled for this repo."

      # -------------------------------------------------------------
      # ğŸš€ Conditional Vercel Deployment
      # -------------------------------------------------------------
      - name: ğŸš€ Conditional Vercel Deployment
        if: success()
        run: echo "All QA checks passed â€“ ready for Vercel deployment âœ”ï¸"
